## 서브 쿼리

- SQL문에 삽입된 query

- select문에서 주로 사용하고 select문에 삽입된 select문

  바깥쪽의 query를 main query, 안쪽에 삽입된 query를 sub query라고 한다.

- sub query는 괄호로 묶어 주어야 한다.
- sub query 메인쿼리가 실행되기 전에 한 번 실행되며 그 실행결과를 메인쿼리에서 사용한다.



### [서브쿼리의 종류]

1) 단일행 서브쿼리 - 결과가 1행 1열인 서브쿼리

2)



### [연산자]

1) in

2) < any : 서브쿼리 결과의 최대값보다 작은 값을 구하는 경우

3) > any : 서브쿼리 결과의 최소값보다 큰 값을 구하는 경우

4) < all : 서브쿼리 결과의 최소값보다 작은 값을 구하는 경우

5) > all : 서브쿼리 결과의 최대값보다 큰 값을 구하는 경우



### [다중컬럼 서브쿼리]

- 두 개 이상의 컬럼과 다중행을 반환하는 서브쿼리

- 메인쿼리 비교 컬럼의 갯수, 종류가 서브쿼리의 반환 결과와 동일

  where (컬럼1, 컬럼2) in (select 컬럼1, 컬럼2....)

  ```sql
  SQL> select ename, deptno, sal, hiredate
    2  from emp
    3  where (deptno, sal) in (select deptno, min(sal)
    4                          from emp
    5                          group by deptno);
  
  ENAME                    DEPTNO        SAL HIREDATE
  -------------------- ---------- ---------- --------
  SMITH                        20        800 80/12/17
  JAMES                        30        950 81/12/03
  MILLER                       10       1300 82/01/23
  ```

  

### [상관형 서브쿼리]

- 메인쿼리의 값이 서브쿼리에서 사용되는 경우
- 메인쿼리 한 row 에 대해 서브쿼리가 한번씩 실행된다
- 메인쿼리의 값이 어떤 값이냐에 따라 서브쿼리의 결과가 달라진다.



​	[실행]

	1. 메인쿼리에서 비교할 값을 가져온다.
 	2. 메인쿼리에서 받은 값을 이용해서 서브쿼리가 실행된다.
 	3. 서브쿼리의 실행결과로 메인쿼리가 실행된다.
 	4. 메인쿼리의 레코드수만큼 반복된다.



### [Inline view]

- from절에서 사용하는 서브쿼리

- 서브쿼리 결과를 가상 테이블로 사용하겠다는 의미

- from절에 추가되는 서브쿼리는 alias를 정의해야한다.

- from절에 추가되는 서브쿼리 내부의 컬럼은 실제 컬럼처럼

  메인쿼리에서 사용해야 하므로 컬럼도 컬럼명이 존재하거나  alias를 정의해야 한다.